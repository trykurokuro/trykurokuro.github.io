define("localSiteSerializer",["lodash","coreUtils","utils","fast-json-stable-stringify"],(function(e,t,n,r){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=895)}({0:function(t,n){t.exports=e},16:function(e,t){e.exports=n},2:function(e,n){e.exports=t},256:function(e,t,n){var r,o;r=[n(0)],void 0===(o=function(e){"use strict";function t(e,t){return e.localeCompare(t)}return function n(r){var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return Array.isArray(r)?r.map((function(e){return n(e,a)})):e.isPlainObject(r)?(o={},Object.keys(r).sort(a).forEach((function(e){o[e]=n(r[e],a)})),o):r}}.apply(t,r))||(e.exports=o)},895:function(e,t,n){var r,o;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(e){var t="function"==typeof Map?new Map:void 0;return(u=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return c(e,arguments,l(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),f(r,e)})(e)}function c(e,t,n){return(c=s()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&f(o,n.prototype),o}).apply(null,arguments)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}r=[n(0),n(896),n(905)],void 0===(o=function(e,t,n){"use strict";var r=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(o,e);var t,n,r=(t=o,n=s(),function(){var e,r=l(t);if(n){var o=l(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return i(this,e)});function o(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=r.call(this,e.message)).name="DecodeError",n.path=t,n.stack=e.stack,n}return o}(u(Error));return function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=o.plugins,i=void 0===a?Object.values(t):a,u=o.encodeWhenSerializing,c=void 0===u||u,s=Object.values(i),f=function(t){var n=Object.assign({},s.reduce((function(n,r){var o=r.serialize;return e.merge(n,o(t))}),{}),{documentSchemaVersion:"1.0"});return c?p(n):n},l=function(t){var n=c?d(t):t;return e(i).reverse().reduce((function(t,r){var o=r.deserialize;return e.merge(t,o(n))}),{})},p=function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.encode,a=e.cloneDeep(t);return s.reduce((function(n,i){return i.getEncryptedPaths(a).forEach((function(a){var i=e.get(t,a);try{i&&e.set(n,a,o(i))}catch(e){throw new r(e,a)}})),n}),a)},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.decode;return p(e,t)};return{serialize:f,deserialize:l,encode:p,decode:d}}}.apply(t,r))||(e.exports=o)},896:function(e,t,n){var r,o;r=[n(0),n(897),n(898),n(899),n(900),n(901),n(902),n(903),n(904)],void 0===(o=function(e,t,n,r,o,a,i,u,c){"use strict";return{styles:t,layout:c,pages:r,menu:u,background:i,commonComponents:n,routers:a,siteInfo:o}}.apply(t,r))||(e.exports=o)},897:function(e,t,n){var r,o;r=[n(0)],void 0===(o=function(e){"use strict";function t(t){return"ComponentStyle"!==t.type&&!e.startsWith(t.id,"style-")}return{serialize:function(n){var r=n.pagesData,o=r.masterPage.data.theme_data,a=o.THEME_DATA.color,i=o.THEME_DATA.font,u=e.omit(o.THEME_DATA,"color","font");e.unset(r.masterPage.data.theme_data,"THEME_DATA");var c=e.pickBy(o,t);return e.forEach(c,(function(t,n){e.unset(r.masterPage.data.theme_data,n)})),{styles:{colors:a,fonts:i,theme:u,topLevelStyles:c}}},deserialize:function(e){var t=e.styles;return{pagesData:{masterPage:{data:{theme_data:Object.assign({THEME_DATA:Object.assign({color:t.colors,font:t.fonts},t.theme)},t.topLevelStyles)}}}}},getEncryptedPaths:function(){return["styles.colors","styles.fonts","styles.theme","styles.topLevelStyles"]}}}.apply(t,r))||(e.exports=o)},898:function(e,t,n){var r,o;r=[n(0),n(256)],void 0===(o=function(e,t){"use strict";var n=function(t){var n=e.omitBy(t.theme_data,{type:"ComponentStyle"});return e.forEach(n,(function(n,r){e.unset(t.theme_data,r)})),t};return{serialize:function(r){var o,a,i,u,c,s=r.pagesData,f=s.masterPage.data;return e.unset(s.masterPage,"data"),{site:{commonComponents:{structure:t((o=s.masterPage.structure,a=e.findIndex(o.children,{id:"PAGES_CONTAINER"}),i=e.findIndex(o.children,{id:"SITE_FOOTER"}),u=e.findIndex(o.children[a].components,{id:"SITE_PAGES"}),c=e.get(o,"children[".concat(a,"].layout.y")),e.set(o,"children[".concat(a,"].layout.height"),400),e.set(o,"children[".concat(i,"].layout.y"),400+c),e.set(o,"children[".concat(a,"].components[").concat(u,"].layout.height"),400),o)),data:n(f)}}}},deserialize:function(e){return{pagesData:{masterPage:e.site.commonComponents}}},getEncryptedPaths:function(){return["site.commonComponents"]}}}.apply(t,r))||(e.exports=o)},899:function(e,t,n){var r,o;function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}r=[n(0),n(256)],void 0===(o=function(e,t){"use strict";var n=function(e,t){return e?a({},t,e):{}};return{serialize:function(t){var r=t.pagesData,o=t.rendererModel,a=t.pagesPlatformApplications,i=e.reduce(a,(function(t,n,r){return e.reduce(n,(function(e,t,n){return e[n]=e[n]||[],e[n].push(r),e}),t)}),{}),u=e(r).mapValues((function(t,n){var r=t.data,o=t.structure.behaviorQuery;if(!o)return null;var a=r.behaviors_data[o],i=JSON.parse(a.items),u=e.find(i,{action:{sourceId:n},behavior:{name:"openPopup"}});return u?{behavior:a,sourceId:n,targetId:u.behavior.targetId}:null})).omitBy(e.isNull).value(),c=e.mapKeys(u,"targetId");return{pages:e(r).keys().filter((function(e){return"masterPage"!==e})).reduce((function(t,a){var s=r.masterPage.data.document_data[a],f=s.pageUriSEO,l=s.title,p=s.isPopup,d=s.id,g=c[a],m=u[a];return t[a]={pageUriSeo:f,title:l,isPopup:p,pageId:d,content:e.assign({},r[a],n(e.get(i,a),"pagesPlatformApplications"),n(o.passwordProtectedPages&&o.passwordProtectedPages.find((function(e){return e===a})),"passwordProtectedPages"))},g&&(t[a].content.lightbox_trigger=g),m&&(e.unset(r[a],["data","behaviors_data",m.behavior.id]),e.unset(r[a],["structure","behaviorQuery"])),e.unset(r.masterPage.data.document_data[a],"pageUriSEO"),e.unset(r.masterPage.data.document_data[a],"title"),t}),{})}},deserialize:function(n){return{pagesData:e(n.pages).keys().filter((function(e){return"masterPage"!==e})).reduce((function(r,o){var i,u=n.pages[o].content.lightbox_trigger,c=e.omit(t(n.pages[o].content),["lightbox_trigger","pagesPlatformApplications","passwordProtectedPages"]),s=e.get(u,["behavior","id"],null),f=s?a({},u.sourceId,{data:{behaviors_data:a({},s,u.behavior)},structure:{behaviorQuery:s}}):{};return e.merge(r,f,(a(i={},o,e.assign(c,{title:n.pages[o].title,pageUriSEO:n.pages[o].pageUriSeo})),a(i,"masterPage",{data:{document_data:a({},o,{isPopup:n.pages[o].isPopup,title:n.pages[o].title,pageUriSEO:n.pages[o].pageUriSeo,id:n.pages[o].pageId})}}),i))}),{}),rendererModel:Object.keys(n.pages).filter((function(e){return"masterPage"!==e})).reduce((function(e,t){var r=n.pages[t].content;return r.pagesPlatformApplications&&(e.pagesPlatformApplications[t]=r.pagesPlatformApplications),delete r.pagesPlatformApplications,e.passwordProtectedPages=e.passwordProtectedPages.concat(r.passwordProtectedPages?r.passwordProtectedPages:[]),delete r.passwordProtectedPages,e}),{pagesPlatformApplications:{},passwordProtectedPages:[]})}},getEncryptedPaths:function(e){return Object.keys(e.pages).map((function(e){return"pages.".concat(e,".content")}))}}}.apply(t,r))||(e.exports=o)},900:function(e,t,n){var r;void 0===(r=function(){"use strict";return{serialize:function(e){var t=e.documentServicesModel,n=e.rendererModel;return{site:Object.assign({},{siteInfo:n.siteInfo,version:{version:t.version,revision:t.revision}},n.multilingualInfo?{multilingualInfo:n.multilingualInfo}:{})}},deserialize:function(e){return{documentServicesModel:Object.assign(e.site.version),rendererModel:Object.assign({siteInfo:e.site.siteInfo},e.site.multilingualInfo?{multilingualInfo:e.site.multilingualInfo}:{})}},getEncryptedPaths:function(){return["site.siteInfo","site.revision","site.version","site.dataFromMasterPage","site.multilingualInfo"]}}}.apply(t,[]))||(e.exports=r)},901:function(e,t,n){var r,o;function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}r=[n(0)],void 0===(o=function(e){"use strict";return{serialize:function(t){var n=t.routers,r=e.get(n,"configMap",{});return{routers:Object.keys(r).reduce((function(e,t){return Object.assign(e,a({},r[t].prefix,Object.assign({},r[t],{routeId:t})))}),{})}},deserialize:function(t){return{rendererModel:{routers:{configMap:Object.keys(t.routers).reduce((function(n,r){return e.merge(n,a({},t.routers[r].routeId,Object.assign({},e.omit(t.routers[r],"routeId"),{prefix:r})))}),{})}}}},getEncryptedPaths:function(e){return Object.keys(e.routers).map((function(e){return"routers.".concat(e)}))}}}.apply(t,r))||(e.exports=o)},902:function(e,t,n){var r,o;r=[n(0),n(16),n(2)],void 0===(o=function(e,t,n){"use strict";var r=t.siteUtils,o=function(t,n,o){return r.getPageBackgroundDataPointers(o,[n]).reduce((function(t,n){var r=n.path;return e.get(o,r)&&(e.set(t,r,e.get(o,r)),e.unset(o,r)),t}),{})},a=function(t,n,o){return r.getPageBackgroundDataPointers(n.content,[o]).forEach((function(r){var o=r.path;e.get(n.content,o)&&(e.set(t,o,e.get(n.content,o)),e.unset(n.content,o))})),t};return{serialize:function(t){var r=t.pagesData,a=r[n.siteConstants.MASTER_PAGE_ID];return{pages:e(r).omit("masterPage").mapValues((function(e,t){return{content:o(0,t,a)}})).value()}},deserialize:function(t){var n=t.pages;return{pagesData:{masterPage:e(n).omit("masterPage").reduce(a,{data:{document_data:{}}})}}},getEncryptedPaths:function(e){return Object.keys(e.pages).map((function(e){return"pages.".concat(e,".content")}))}}}.apply(t,r))||(e.exports=o)},903:function(e,t,n){var r,o;function a(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}r=[n(0)],void 0===(o=function(e){"use strict";var t=["PageLink","AnchorLink"],n=function(e){return e.replace(/^#/,"")};return{serialize:function(r){var o,a,i=r.pagesData,c={menus:{},pages:{}},s=(o=i.masterPage,a=o.data.document_data,e(a).get("CUSTOM_MENUS.menus",[]).reduce((function(t,r){var o=n(r),i=e.get(a,o);return e.set(t,o,i)}),{})),f=e.reduce(s,(function(t,r,o){return e.set(t,o,function(t,r){return e.flattenDeep(function r(o){var a=o.dataId,i=o.parent,u=void 0===i?null:i,c="data.document_data.".concat(n(a)),s=[],f=e.get(t,"".concat(c,".items"));return f.length>0&&s.push(f.map((function(e){return r({dataId:e,parent:n(a)})}))),s.concat([{path:c,parent:u}])}({dataId:r}))}(i.masterPage,o))}),{});return e.forEach(f,(function(r,o){c.menus[o]=c.menus[o]||{data:{},structure:{}},e.forEach(r,(function(r){var a=r.path,s=e.get(i.masterPage,a),f=s.link&&e.get(i.masterPage,"data.document_data.".concat(n(s.link)));f&&"_self"===f.target&&e.omit(f,["target"]);var l=e.assign({},u({},s.id,e.omit(s,"items")),f?u({},f.id,f):{});if(e.set(c.menus[o],"structure.".concat(s.id),{id:s.id,items:s.items}),function(e){return e&&t.includes(e.type)&&"masterPage"!==n(e.pageId)}(f)){var p=n(f.pageId);e.set(c.pages,"".concat(p,".content.menus.").concat(o),l)}else e.merge(c.menus[o].data,l);e.forEach(l,(function(t,n){return e.unset(i.masterPage.data.document_data,n)})),e.unset(i.masterPage,a)}))})),c},deserialize:function(t){return{pagesData:{masterPage:{data:{document_data:e.reduce(t.menus,(function(r,o,i){var u,c=o.structure,s=o.data,f=e(c).map("items").flattenDeep().map(n).value(),l=e.reduce(t.pages,(function(t,n){return e.assign(t,e.get(n.content,"menus.".concat(i)),{})}),{}),p=e(l).filter((function(e){return"BasicMenuItem"===e.type&&!f.includes(e.id)})).map((function(e){return"#".concat(e.id)})).value();return(u=c[i].items).push.apply(u,a(p)),e.merge(r,l,s,c,p)}),{})}}}}},getEncryptedPaths:function(t){return e(t.menus).keys().map((function(e){return"menus.".concat(e)})).concat(e(t.pages).keys().map((function(e){return"pages.".concat(e,".content.menus")})).value()).value()}}}.apply(t,r))||(e.exports=o)},904:function(e,t,n){var r,o;r=[n(0),n(2)],void 0===(o=function(e,t){"use strict";return{serialize:function(n){var r=n.pagesData;return{pages:e(r).omit(t.siteConstants.MASTER_PAGE_ID).mapValues((function(t,n){return o=r[n].structure,e.unset(o,"layout.width"),e.set({},"content.structure.layout.width",980);var o})).value()}},deserialize:e.noop,getEncryptedPaths:function(){return[]}}}.apply(t,r))||(e.exports=o)},905:function(e,t,n){var r,o;r=[n(0),n(906)],void 0===(o=function(e,t){"use strict";return{encode:function(n){return e.flow([t,encodeURIComponent,unescape,btoa])(n)},decode:function(t){return e.flow([atob,escape,decodeURIComponent,JSON.parse])(t)}}}.apply(t,r))||(e.exports=o)},906:function(e,t){e.exports=r}})}));
//# sourceMappingURL=localSiteSerializer.min.js.map