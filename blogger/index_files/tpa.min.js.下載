define("tpa",["lodash","coreUtils","componentsCore","reactDOM","zepto","experiment","warmupUtils","utils","core","tpaComponents","pmrpc"],(function(e,t,n,i,a,o,r,s,p,c,u){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1187)}({0:function(t,n){t.exports=e},1187:function(e,t,n){var i,a;i=[n(0),n(289),n(290),n(16),n(291),n(294),n(1190),n(29)],void 0===(a=function(e,t,n,i,a,o,r,s){"use strict";return e.assign({},s,{tpaHandlers:n,common:e.assign({},s.common,{tpaPostMessageCommon:t,styleUtils:i.styleUtils,bi:o}),services:e.assign({},s.services,{tpaNavigationService:a}),tpaStyleUtils:i.styleUtils})}.apply(t,i))||(e.exports=a)},1188:function(e,t,n){var i,a;i=[n(9)],void 0===(a=function(e){"use strict";var t=e.tpaWarmup,n=function(e,n,i){if(e&&e.reportPerformanceBiEvent){var a=e.getAppData(),o=e.getWidgetId();t.reportPerformanceBiEvent(n,e.props.reportBI,e.props.biData,e.props.id,e.props.isTpaRenderedInSsr,a,o,i)}};return{applicationLoaded:function(e,i){var a=e.getComponentById(i.compId);n(a,t.events.APP_LOADED_SUCCESSFULLY)},applicationLoadingStep:function(e,i){var a=e.getComponentById(i.compId),o={stage:i.data.stage,stageNum:i.data.stageNum};n(a,t.events.APP_LOADED_PARTIALLY,o)}}}.apply(t,i))||(e.exports=a)},1189:function(e,t,n){var i,a;i=[n(29),n(2)],void 0===(a=function(e,t){"use strict";var n=function(){};return{toWixDate:n,getCompId:n,getOrigCompId:n,getWidth:n,isInModal:n,getLocale:n,getCacheKiller:n,getTarget:n,getInstanceId:n,getSignDate:n,getUid:n,getPermissions:n,getIpAndPort:n,getDemoMode:n,getDeviceType:n,getInstanceValue:n,getSiteOwnerId:n,getImageUrl:n,getResizedImageUrl:n,getAudioUrl:n,getDocumentUrl:n,getSwfUrl:n,getPreviewSecureMusicUrl:n,getStyleParams:function(n,i){var a=e.common.utils.getAppDefId(n,i.compId);t.loggingUtils.performance.start("getStyleParams ".concat(a),e.common.metaData.PERF_CATEGORY)},getStyleColorByKey:n,getColorByreference:n,getEditorFonts:n,getSiteTextPresets:n,getFontsSpriteUrl:n,getStyleFontByKey:n,getStyleFontByReference:n,getSiteColors:n,setUILIBParamValue:n,tpaWorker:{getViewMode:n,getDeviceType:n,getLocale:n,getInstanceId:n,getIpAndPort:n}}}.apply(t,i))||(e.exports=a)},1190:function(e,t,n){var i,a;i=[n(3),n(1191),n(1192),n(1194),n(1195),n(1197),n(1198),n(1199),n(1200),n(1201),n(1202),n(1203),n(1204)],void 0===(a=function(e,t,n,i,a,o,r,s,p,c,u,g,d){"use strict";var l=e.siteAspectsRegistry;l.registerSiteAspect("tpaWorkerAspect",t),l.registerSiteAspect("tpaPostMessageAspect",n),l.registerSiteAspect("tpaPopupAspect",i),l.registerSiteAspect("tpaPubSubAspect",a),l.registerSiteAspect("tpaPixelTrackerAspect",o),l.registerSiteAspect("tpaModalAspect",r),l.registerSiteAspect("tpaMobileViewportAspect",s),l.registerSiteAspect("tpaCompStateAspect",p),l.registerSiteAspect("tpaComponentsDomAspect",c),l.registerSiteAspect("tpaPageNavigationAspect",u),l.registerSiteAspect("TPARPCAspect",g),l.registerSiteAspect("tpaWidgetNativeAspect",d)}.apply(t,i))||(e.exports=a)},1191:function(e,t,n){var i,a;i=[n(0)],void 0===(a=function(e){"use strict";function t(e){this._aspectSiteAPI=e}return t.prototype={getComponentsToRender:function(){var t=this._aspectSiteAPI.getSiteData().getClientSpecMap(),n=this.getTPAWorkers(t);return e.map(n,(function(e){var t,n="tpaWorker_".concat(e.applicationId);return{structure:(t=n,{componentType:"tpa.viewer.classes.TPAWorker",skin:"wysiwyg.viewer.skins.TPAWidgetSkin",type:"Component",id:t}),props:{compData:e}}}))},getTPAWorkers:function(t){return e.filter(t,(function(t){return e.isString(t.appWorkerUrl)&&t.permissions&&!t.permissions.revoked}))}},t}.apply(t,i))||(e.exports=a)},1192:function(e,t,n){var i,a;i=[n(0),n(289),n(290),n(1193),n(293),n(29),n(294),n(46),n(2)],void 0===(a=function(e,t,n,i,a,o,r,s,p){"use strict";var c={getCtToken:!0,refreshCurrentMember:!0};var u=function(t){if(e.has(t,"data")&&!e.isNull(t.data))return t.data.eventKey&&p.stringUtils.startsWith(t.data.eventKey,o.common.utils.Constants.TPA_PUB_SUB_PREFIX)},g=function(e){return u(e)?i:(t=e.compId)&&p.stringUtils.startsWith(t,"tpaWorker_")?n.tpaWorker:n;var t},d=function(n,i,a){if(function(t,n,i){var a=n&&t.getComponentById(n);return("appStateChanged"!==i||a&&e.includes(t.getAllRenderedRootIds(),a.props.rootId))&&function(e,t,n){return!c[n]||o.services.clientSpecMapService.isSuperAppByCompId(e,t)}(t,n,i)}(n,i.compId,i.type)&&!function(e,t,n){if(!t.compId)return!1;if(e.getComponentById(t.compId))return!1;return e.getSiteAspect("tpaPostMessageAspect").queueMessage({msg:t,response:n}),!0}(n,i,a)){var s=t.fixOldPingPongMessageType(i.type),p=g(i);if(p[s]&&(p[s].call(this,n,i,a),function(t,n){if("registerEventListener"===n.type&&!u(n))return e.includes(o.common.supportedSiteEvents,n.data.eventKey);return!0}(0,i))){var d=n.getComponentById(i.compId);r.sendBIEvent(i,i.origin||"viewer",e.get(d,"props.compData"),o.common.utils.getClientSpecMap(n),n.reportBI)}}},l=function(t){return function t(n,i){return e.isFunction(n)?e.partial(n,i):e.isObject(n)?e.mapValues(n,(function(e){return t(e,i)})):n}({openModal:a.openModal,openPopup:a.openPopup},t)};var f=function(t){var n=this;e.bindAll(this,e.functionsIn(this)),t.registerToMessage(this.handleTPAMessage),t.getSiteData().isInSSR()||t.getSiteData().isAddPanelView||s.api.set("tpaHandlers",l(t)),this._siteAPI=t,this._messageQueue=[],t.registerToOnFullyRendered((function(){e.forEach(n._messageQueue,(function(e){var t=e.msg,i=e.response;d(n._siteAPI,t,i)})),n._messageQueue.length=0}))};return f.prototype={handleTPAMessage:function(e){t.handleTPAMessage.call(this,void 0,this._siteAPI,d,e)},sendPostMessage:function(e,n){var i=e.getIframe();if(i)t.callPostMessage(i,n);else if(this._siteAPI.getSiteData().isDebugMode())throw new Error("No iframe found in TPA component",e)},queueMessage:function(e){this._messageQueue.push(e)},callHandler:d},f}.apply(t,i))||(e.exports=a)},1193:function(e,t,n){var i,a;i=[n(29),n(2)],void 0===(a=function(e,t){"use strict";var n=t.loggingUtils.logger;return{registerEventListener:function(e,t){e.getSiteAspect("tpaPubSubAspect").subscribe(t)},publish:function(t,i){var a=i.data,o=i.compId,r=e.common.utils.getAppDefId(t,o);r?(a.eventKey=e.common.utils.stripPubSubPrefix(a.eventKey),t.getSiteAspect("tpaPubSubAspect").publish(r,o,a)):n.reportBI(t.getSiteData(),e.bi.errors.SDK_PUBSUB_PUBLISH_ERROR)},removeEventListener:function(t,n){var i=n.compId,a=n.data,o=e.common.utils.getAppDefId(t,i),r=e.common.utils.stripPubSubPrefix(a.eventKey);t.getSiteAspect("tpaPubSubAspect").unsubscribe(o,i,r)}}}.apply(t,i))||(e.exports=a)},1194:function(e,t,n){var i,a;i=[n(0),n(2)],void 0===(a=function(e,t){"use strict";function n(e){return e.getAspectGlobalData("tpaPopupAspect")}function i(t){return t&&e.isArray(t)&&t.length>0}function a(t){this.aspectSiteApi=t,e.bindAll(this,e.functionsIn(this)),this.aspectSiteApi.registerToUrlPageChange(this.removeAllPopups)}return a.prototype={getComponentsToRender:function(){var t=n(this.aspectSiteApi);return i(t)?e.map(t,(function(e){return{structure:e.structure,props:{compData:e.popupData,onCloseCallback:e.popupOnClose}}})):null},showPopup:function(e,a){var o={structure:{componentType:"wysiwyg.viewer.components.tpapps.TPAPopup",type:"Component",id:t.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAPopupSkin",styleId:""},popupData:e,popupOnClose:a},r=n(this.aspectSiteApi);i(r)||(r=[]),r.push(o),this.aspectSiteApi.setAspectGlobalData("tpaPopupAspect",r),this.aspectSiteApi.forceUpdate()},removePopup:function(t){var a=t.props.id,o=n(this.aspectSiteApi);i(o)&&(o=e.reject(o,{structure:{id:a}}),this.aspectSiteApi.setAspectGlobalData("tpaPopupAspect",o),this.aspectSiteApi.forceUpdate())},removeAllPopups:function(){var t=n(this.aspectSiteApi);i(t)&&(this.aspectSiteApi.setAspectGlobalData("tpaPopupAspect",function(t){return e.filter(t,{popupData:{persistent:!0}})}(t)),this.aspectSiteApi.forceUpdate())}},a}.apply(t,i))||(e.exports=a)},1195:function(e,t,n){var i,a;i=[n(0),n(29),n(1196)],void 0===(a=function(e,t,n){"use strict";var i=function(t){this.aspectSiteAPI=t,this.hub=new n,e.bindAll(this,e.functionsIn(this))};return i.prototype={publish:function(n,i,a){var o=this,r=a.eventKey,s=a.isPersistent,p=this.hub.getEventListeners(n,r),c=this.hub.getWorkerEventListeners(n,r),u={eventType:t.common.utils.addPubSubEventPrefix(r),intent:"addEventListener",params:{data:a.eventData,name:r,origin:i}};if(e.forEach(p,(function(e){return o._sendDataToComp(e,u)})),e.forEach(c,(function(e){return o._sendMessageToWorker(e,n,{eventKey:r,eventData:u.params})})),s){var g=a.eventData;this.hub.persistData(n,r,i,g)}},subscribe:function(n){var i=n.compId,a=n.data,o=t.common.utils.stripPubSubPrefix(a.eventKey),r=a.receivePastEvents,s=t.common.utils.getAppDefId(this.aspectSiteAPI,i);if(this.hub.addEventListener(s,o,i),r){var p=this.hub.getPersistedData(s,o);if(!e.isEmpty(p)){var c={intent:"TPA_RESPONSE",callId:n.callId,type:n.type,res:{drain:!0,data:p},status:!0,compId:i};this._sendDataToComp(i,c)}}},unsubscribe:function(e,t,n){this.hub.getEventListeners(e,n)&&this.hub.removeEventListener(e,n,t)},deleteCompListeners:function(e,t){this.hub.deleteCompListeners(e,t)},subscribeAsPlatformWorker:function(t,n,i,a,o){if(this.hub.addWorkerEventListener(t,i,n),a){var r=this.hub.getPersistedData(t,i);e.isEmpty(r)||this._sendMessageToWorker(n,t,{eventKey:i,callbackId:o,eventDataArray:r,invokePastEvents:!0})}},unsubscribeAsPlatformWorker:function(e,t,n){this.hub.getWorkerEventListeners(e,n)&&this.hub.removeWorkerEventListener(e,n,t)},_sendDataToComp:function(e,t){var n=this.aspectSiteAPI.getComponentById(e);n&&n.sendPostMessage(t)},_sendMessageToWorker:function(e,t,n){this.aspectSiteAPI.getSiteAPI().getSiteAspect("WidgetAspect").getWidgetHandler().invokeWorkerSubscribers(e,t,n)}},i}.apply(t,i))||(e.exports=a)},1196:function(e,t,n){var i,a;i=[n(0),n(2)],void 0===(a=function(e,t){"use strict";var n=function(e){this.hub=e||{}};return n.prototype={persistData:function(e,n,i,a){var o={data:a,name:n,origin:i},r=this._addEvent(e,n);r.data.length>=1e3&&(t.log.warn("You have exceeded the data limit, and some of the data will be lost! Please make sure you are not persisting unneeded data."),r.data.shift()),r.data.push(o)},addEventListener:function(t,n,i){var a=this._addEvent(t,n);e.includes(a.listeners,i)||a.listeners.push(i)},addWorkerEventListener:function(t,n,i){var a=this._addEvent(t,n);e.includes(a.workerListeners,i)||a.workerListeners.push(i)},removeEventListener:function(t,n,i){var a=this._getEvent(t,n);a&&(a.listeners=e.without(a.listeners,i))},removeWorkerEventListener:function(t,n,i){var a=this._getEvent(t,n);a&&(a.workerListeners=e.without(a.workerListeners,i))},getPersistedData:function(e,t){var n=this._getEvent(e,t);return n&&n.data},getEventListeners:function(e,t){var n=this._getEvent(e,t);return n&&n.listeners},getWorkerEventListeners:function(e,t){var n=this._getEvent(e,t);return n&&n.workerListeners},deleteCompListeners:function(t,n){var i=this,a=this._getAppEvents(t);e.forOwn(a,(function(e,a){i.removeEventListener(t,a,n)}))},_addEvent:function(e,t){var n=this.hub[e];n||(n=this.hub[e]={});var i=n[t];return i||(i=n[t]={data:[],listeners:[],workerListeners:[]}),i},_getEvent:function(e,t){var n=this.hub[e];if(n)return n[t]},_getAppEvents:function(e){return this.hub[e]}},n}.apply(t,i))||(e.exports=a)},1197:function(e,t,n){var i,a;i=[n(0),n(2),n(29)],void 0===(a=function(e,t,n){"use strict";var i=t.urlUtils,a=t.throttleUtils.throttledForEach,o=function(){var t,o=this._aspectSiteAPI.getPageUrl.bind(this._aspectSiteAPI),s=(t=this._aspectSiteAPI.getSiteData().getClientSpecMap(),e.filter(t,(function(t){return e.isString(t.pixelUrl)&&t.permissions&&!t.permissions.revoked}))),p=e.map(s,(function(e){return new n.common.TPAUrlBuilder(e.pixelUrl).addMultipleQueryParams({instance:e.instance,page:o(),ck:i.cacheKiller()}).build()}));a(p,r.sendRequest,r.CHUNK_SIZE,r.CHUNK_INTERVAL)};function r(e){this._aspectSiteAPI=e,this._aspectSiteAPI.registerToComponentDidMount(o.bind(this)),this._aspectSiteAPI.registerToUrlPageChange(o.bind(this))}return r.sendRequest=function(e){new window.Image(0,0).src=e},r.CHUNK_SIZE=1,r.CHUNK_INTERVAL=100,r}.apply(t,i))||(e.exports=a)},1198:function(e,t,n){var i,a;i=[n(0),n(2)],void 0===(a=function(e,t){"use strict";function n(t){this.aspectSiteApi=t,e.bindAll(this,e.functionsIn(this))}return n.prototype={getComponentsToRender:function(){var t=function(t){var n=t.getAspectGlobalData("tpaModalAspect");return e.get(n,"modalStructure")}(this.aspectSiteApi);if(t){var n=this.aspectSiteApi.getAspectGlobalData("tpaModalAspect");return[{structure:t,props:{compData:n.modalData,onCloseCallback:n.modalOnClose,key:t.id}}]}return null},showModal:function(e,n){this.aspectSiteApi.getSiteData().isMobileView()&&("LIGHT_BOX"===e.theme?(this.aspectSiteApi.exitFullScreenMode(),this.aspectSiteApi.setSiteRootHiddenState(!0)):(this.aspectSiteApi.enterFullScreenMode({scrollable:!1}),this.aspectSiteApi.setSiteRootHiddenState(!1))),this.aspectSiteApi.setSiteRootAriaHiddenState(!0),this.aspectSiteApi.getComponentById("SITE_BACKGROUND").setAriaHiddenState(!0),this.aspectSiteApi.setAspectGlobalData("tpaModalAspect",{modalStructure:{componentType:"wysiwyg.viewer.components.tpapps.TPAModal",type:"Component",id:t.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAModalSkin"},modalData:e,modalOnClose:n}),this.aspectSiteApi.forceUpdate()},removeModal:function(){this.aspectSiteApi.getSiteData().isMobileView()&&(this.aspectSiteApi.exitFullScreenMode(),this.aspectSiteApi.setSiteRootHiddenState(!1)),this.aspectSiteApi.setSiteRootAriaHiddenState(!1),this.aspectSiteApi.getComponentById("SITE_BACKGROUND").setAriaHiddenState(!1),this.aspectSiteApi.setAspectGlobalData("tpaModalAspect",{modalStructure:null})}},n}.apply(t,i))||(e.exports=a)},1199:function(e,t,n){var i,a;i=[n(0),n(2),n(8),n(29)],void 0===(a=function(e,t,n,i){"use strict";var a="tpaMobileViewportAspect",o=function(t){this.aspectSiteAPI=t,e.bindAll(this,e.functionsIn(this)),this.aspectSiteAPI.registerToSiteReady(this.fixMobileViewportIfNeeded),this.aspectSiteAPI.registerToUrlPageChange(this.fixMobileViewportIfNeeded)};return o.prototype={fixMobileViewportIfNeeded:function(){var e=this.aspectSiteAPI.getSiteData();if(n.isOpen("sv_tpaMobileViewportFix",e)){var o=this.aspectSiteAPI.getAspectGlobalData(a);if(i.services.clientSpecMapService.isCurrentPageFullResponsive(e)){if(!o||!o.isResponsive){var r={isResponsive:!0};this.aspectSiteAPI.setAspectGlobalData(a,r),t.mobileViewportFixer.fixViewportTag(e,r)}}else o&&o.isResponsive&&(this.aspectSiteAPI.setAspectGlobalData(a,null),t.mobileViewportFixer.fixViewportTag(e,null))}}},o}.apply(t,i))||(e.exports=a)},1200:function(e,t,n){var i,a;i=[n(0)],void 0===(a=function(e){"use strict";var t=function(t){this.siteAspectsSiteAPI=t,e.bindAll(this,e.functionsIn(this))};return t.prototype={updateSectionUrlState:function(e,t){var n=this.siteAspectsSiteAPI.getComponentById(e);n&&n.setState({sectionUrlState:t})},updatePushState:function(e,t){var n=this.siteAspectsSiteAPI.getComponentById(e);n&&n.setState({pushState:t})},updateSectionUrlParams:function(e,t){var n=this.siteAspectsSiteAPI.getComponentById(e);n&&n.setState({sectionUrlParams:t})},reportStateChanged:function(e,t){var n=this.siteAspectsSiteAPI.getComponentById(e);n&&n.reportStateChanged(t)},updatePreventRefreshState:function(e,t){var n=this.siteAspectsSiteAPI.getComponentById(e);n&&n.setState(t)},setCompState:function(e,t){var n=this.siteAspectsSiteAPI.getComponentById(e);n&&n.setState(t)}},t}.apply(t,i))||(e.exports=a)},1201:function(e,t,n){var i,a;i=[n(0)],void 0===(a=function(e){"use strict";function t(t){this.aspectSiteApi=t,this.aliveTpaComponentPromises={},this.handleComponentIsAlive={},e.bindAll(this,e.functionsIn(this))}return t.prototype={clearComponentIsAlive:function(e){delete this.handleComponentIsAlive[e],delete this.aliveTpaComponentPromises[e]},markComponentIsAlive:function(e){var t=function(e,t){return e.getComponentById(t)}(this.aspectSiteApi,e);this.handleComponentIsAlive[e]?this.handleComponentIsAlive[e](t):this.aliveTpaComponentPromises[e]=Promise.resolve(t)},getComponentWhenReady:function(e){var t=this.aliveTpaComponentPromises;return t[e]=t[e]||new Promise(function(t){this.handleComponentIsAlive[e]=t}.bind(this)),t[e]}},t}.apply(t,i))||(e.exports=a)},1202:function(e,t,n){var i,a;i=[n(0),n(29)],void 0===(a=function(e,t){"use strict";var n=function(e,t){this._listeners={},this._siteAPI=e,this._currentPageId=t||this._siteAPI.getSiteData().getCurrentUrlPageId(),this._siteAPI.registerToUrlPageChange(this.notifyPageChanged.bind(this))};return n.prototype={notifyPageChanged:function(){var n=this._siteAPI.getSiteData().renderFlags.shouldRenderTPAsIframe,i=this._siteAPI.getSiteData().getCurrentUrlPageId(),a=this._currentPageId;e.forEach(this._listeners,function(o){e.forEach(o,function(o){var r=o.comp.props.rootId;if(o.comp._isMounted&&n&&function(e,n,i,a){return e.type===t.common.supportedSiteEvents.PAGE_NAVIGATION||e.type===t.common.supportedSiteEvents.PAGE_NAVIGATION_CHANGE||e.type===t.common.supportedSiteEvents.PAGE_NAVIGATION_IN&&a===n||e.type===t.common.supportedSiteEvents.PAGE_NAVIGATION_OUT&&a===i}(o,i,a,r)){var s={toPage:i,fromPage:a,isAppOnPage:r===i,wasAppOnPage:r===a},p=e.get(this._siteAPI.getSiteData().getExistingRootNavigationInfo(i),"routerPublicData");p&&(s.routerData=p),o.comp.sendPostMessage({intent:"addEventListener",eventType:o.type,params:s})}}.bind(this))}.bind(this)),this._currentPageId=i},registerToPageChanged:function(e,t){var n=this._listeners[e.props.id];n||(n=this._listeners[e.props.id]=[]),n.push({comp:e,type:t})},unregisterToPageChanged:function(e){delete this._listeners[e.props.id]}},n}.apply(t,i))||(e.exports=a)},1203:function(e,t,n){var i,a;function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}i=[n(0),n(46),n(2),n(29)],void 0===(a=function(e,t,n,i){"use strict";var a,r="Widget",c=(p(a={},"Page",i.common.utils.isTPASection),p(a,r,i.common.utils.isGluedWidget),a),u="Callback Timeout Expired",g="ComponentId Not Found",d="ApplicationId Not Found",l="Component Not Supported";function f(e){return"tpa_public_api_"+e}function m(t,a,o){var r=t.getPageData().id,s=n.siteConstants.MASTER_PAGE_ID,p=e.get(i.common.utils.getAppDataByAppDefinitionId(t,a),"applicationId");if(!p)return{compId:null,error:d};var u=t.getCompsDataOnPage(r).concat(t.getCompsDataOnPage(s)).filter((function(t){return function(t,n){return e.get(t,"applicationId")===n.toString()}(t,p)}));if(0===u.length)return{compId:null,error:g};var f=u.filter((function(t){return function(t,n){return e.get(c,n,(function(){return!1}))(t)}(t,o)}));return 0===f.length||f.length>1?{compId:null,error:l}:{compId:e.get(f[0],"compId")}}function v(t){return e.get(t.getSiteData().getExistingRootNavigationInfo(),"tpaInnerRoute")}function I(e,t){return i.common.utils.isTPASection({componentType:e.getComponentType(t)})}var S=function(){function t(e,n,i){var a=this;o(this,t),this.compId=e,this.isTPASection=n,this.getCurrentSectionStateFunc=i,this.resolved=!1,this.rejected=!1,this.tpaSectionState=void 0,this.subscribers=[],this.timeoutId=setTimeout((function(){return a.reject()}),3e4)}return s(t,[{key:"resolve",value:function(){this.resolved=!0,this.invokeSubscribers(f(this.compId)),clearTimeout(this.timeoutId),this.isTPASection&&(this.tpaSectionState=this.getCurrentSectionStateFunc())}},{key:"reject",value:function(){this.rejected=!0,this.invokeSubscribers(null,u)}},{key:"reset",value:function(){this.resolved=!1,this.rejected=!1,this.subscribers=[]}},{key:"subscribe",value:function(e){this.subscribers.push(e)}},{key:"invokeSubscribers",value:function(t,n){e.invokeMap(this.subscribers,e.call,null,t,n),this.subscribers=[]}}]),t}();return function(){function n(t){o(this,n),this.siteAPI=t,this.apiStore={},this.getCurrentSectionStateFunc=e.partial(v,this.siteAPI)}return s(n,[{key:"registerApi",value:function(e,n){if(!this.apiStore[n]){var i=I(this.siteAPI,n);this.apiStore[n]=new S(n,i,this.getCurrentSectionStateFunc)}this.apiStore[n].resolve(),t.api.request(f(n),{initiator:e}).then((function(e){return t.api.set(f(n),e)}))}},{key:"requireComponentAPI",value:function(e,t){var n=I(this.siteAPI,e);this.apiStore[e]||(this.apiStore[e]=new S(e,n,this.getCurrentSectionStateFunc)),n&&this.getCurrentSectionStateFunc()!==this.apiStore[e].tpaSectionState&&this.apiStore[e].reset(),this.apiStore[e].resolved?t(f(e)):this.apiStore[e].rejected?t(null,u):this.apiStore[e].subscribe(t)}},{key:"requireSingletonAPI",value:function(e,t,n){var i=m(this.siteAPI,e,t);i.compId?this.requireComponentAPI(i.compId,n):n(null,i.error)}}]),n}()}.apply(t,i))||(e.exports=a)},1204:function(e,t,n){var i,a;i=[n(0)],void 0===(a=function(e){"use strict";return function(t){var n=t.getSiteData(),i=n.isInSSR(),a=function(e){return t.getAspectComponentData("tpaWidgetNativeAspect",e)||{}},o=n.tpaWidgeNativeAspectWarmupData;return i&&t.getDisplayedDAL().setByPath(["siteAspectsData","tpaWidgetNativeAspect","dataByCompId"],{}),e.forOwn(o,(function(e,n){return t.updateAspectComponentData("tpaWidgetNativeAspect",n,e)})),{setControllerProps:function(n,i){var o=a(n);!function(e,n){t.updateAspectComponentData("tpaWidgetNativeAspect",e,n)}(n,{wixCodeProps:e.defaults(i.wixCodeProps,o.wixCodeProps),events:e.defaults(i.events,o.events)})},getControllerProps:a}}}.apply(t,i))||(e.exports=a)},16:function(e,t){e.exports=s},2:function(e,n){e.exports=t},23:function(e,t){e.exports=p},289:function(e,t,n){var i,a;i=[n(0)],void 0===(a=function(e){"use strict";var t={TPA_MESSAGE:"TPA",TPA_MESSAGE_PREVIEW:"TPA_PREVIEW",TPA_MESSAGE2:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",TPA_PREVIEW_RESPONSE:"TPA_PREVIEW_RESPONSE",PINGPONG_PREFIX:"pingpong:"},n=function(e,t,n){var i="";try{i=JSON.stringify(t)}catch(e){return}e.postMessage||(e=e.contentWindow),e.postMessage(i,n||"*")},i=function(e,i,a){return function(o){try{n(e,{intent:a||t.TPA_RESPONSE,callId:i.callId,type:i.type,res:o,status:!0})}catch(e){}}},a=function(e){return e===t.TPA_MESSAGE||e===t.TPA_MESSAGE2},o=function(e,t,n){return s(e,t,n)||r(t,n)||p(t,n)},r=function(e,t){return 0===(e.getPageUrl()||"").indexOf(t)},s=function(t,n,i){var a=n.getComponentById(t);return 0===e.get(a,"refs.iframe.src","").indexOf(i)},p=function(e,t){var n=e.getSiteData().getServiceTopologyProperty("baseDomain")||"";return n=n.replace(/\./gi,"\\."),new RegExp("[./]{1}".concat(n,"$"),"ig").test(t)};return{Intents:t,callPostMessage:n,generateResponseFunction:i,isTPAMessage:a,fixOldPingPongMessageType:function(e){return e.replace(t.PINGPONG_PREFIX,"")},handleTPAMessage:function(n,r,s,p){var c=function(e){var t;try{e.data?t=JSON.parse(e.data):e.originalEvent&&e.originalEvent.data&&(e=e.originalEvent,t=JSON.parse(e.data))}catch(e){}return t}(p),u=p.originalEvent?p.originalEvent.origin:p.origin;if(c&&a(c.intent)){if(n)s(n,c,i(p.source,c));else if(o(c.compId,r,u)){var g=function(e){return e.getSiteData().viewMode}(r);!function(e,t){return!("preview"===e&&{getSectionUrl:!0,siteInfo:!0,navigateToPage:!0,getExternalId:!0,smRequestLogin:!0,getValue:!0,getValues:!0,getPublicData:!0,getCurrentPageAnchors:!0,getComponentInfo:!0,navigateToSectionPage:!0,isAppSectionInstalled:!0,getStateUrl:!0,getSitePages:!0,getSiteMap:!0,smCurrentMember:!0,refreshCurrentMember:!0,onReady:!0,revalidateSession:!0}[t.type])}(g,c)&&function(t){return"preview"===t.getSiteData().viewMode&&e.get(window,"documentServices.tpa.__privates.areDocumentServicesHandlersReady")&&window.documentServices.tpa.__privates.areDocumentServicesHandlersReady()}(r)||(c.origin="site"===g?"viewer":g,s(r,c,i(p.source,c)))}}else c&&c.intent===t.TPA_MESSAGE_PREVIEW&&(n?s(n,c,i(p.source,c,t.TPA_PREVIEW_RESPONSE)):o(c.compId,r,u)&&s(r,c,i(p.source,c,t.TPA_PREVIEW_RESPONSE)))}}}.apply(t,i))||(e.exports=a)},29:function(e,t){e.exports=c},290:function(e,t,n){var i,a;i=[n(7),n(0),n(2),n(23),n(3),n(16),n(6),n(9),n(29),n(291),n(292),n(1188),n(1189),n(293),n(8)],void 0===(a=function(e,t,n,i,a,o,r,s,p,c,u,g,d,l,f){"use strict";var m=o.logger,v=s.tpaWarmup,I=p.common.metaData.PERF_CATEGORY,S=a.activityTypes.TPAActivity,A=a.activityService;function P(e){return e.getSiteAspect("siteMembers")}var h=function(e,t,n){var i={},a=e.getSiteData().getDataByQuery(e.getSiteData().getCurrentUrlPageId()),o=e.getSiteData().getCurrentUrlPageTitle();p.common.utils.sdkVersionIsAtLeast(t.version,"1.42.0")?i.pageTitle=o:(i.siteTitle=o,i.pageTitle=a.title),i.pageTitleOnly=e.getSiteData().getCurrentUrlPageName(),i.siteDescription=a.descriptionSEO,i.siteKeywords=a.metaKeywordsSEO;var r=e.getSiteData().currentUrl;i.url=r.full,i.baseUrl=e.getSiteData().getExternalBaseUrl(),i.referer=window.document.referrer,n(i)},y=function(e,t){e&&e({error:{message:t}})},C=function(e,n,i){var a={filterHideFromMenuPages:!0,includePagesUrl:t.get(n,"data.includePagesUrl",!1),includeIsHomePage:!0,enhancedInfo:!1};i(p.sitePages.getSitePagesInfoData(e.getSiteData(),a))},D=function(e,t,n){n(p.sitePages.getSitePagesInfoData(e.getSiteData(),{filterHideFromMenuPages:!0,includePagesUrl:!1,includeIsHomePage:!1,enhancedInfo:!0}))},T=function(e,n,i){var a,o=e.getComponentById(n.compId),r=t.get(n,"data.sectionIdentifier.appDefinitionId");r?a=p.common.utils.getAppDataByAppDefinitionId(e,r):o&&(a=o.getAppData());var s=t.get(a,"applicationId"),u=p.services.pageService.mapPageToWidgets(e),g=t.get(u,s),d=e.getSiteData().getPrimaryPageId();c.navigateToSection(e,a,n,g,d,(function(n){var i=e.getComponentsByPageId(n),a=t.find(i,"isTPASection");return t.get(a,"props.id")}),e.getSiteData().isDynamicPage,i,t.partial(ne,e,a))},b=function(e,n,i,a,o){var r=e.getSiteData();if(a=a||r.getFocusedRootId(),(n=n||_(e,i,a))&&(E(n)||n.props.rootId===a)){var s=w(n,e);r.animations.animate("BaseScroll",e.getSiteContainer(),1,0,{y:s.y,x:s.x,callbacks:{onComplete:o}})}else{var p=t.isEmpty(a)?"Current page":'Page id "'.concat(a,'"');o({error:{message:"".concat(p,' does not contain the component id "').concat(i,'".')}})}},E=function(e){return"masterPage"===e.props.rootId},_=function(e,t,n){return e.getComponentsByPageId(n)[t]},w=function(e,n){var i=n.getSiteData(),a=r.findDOMNode(e),s=i.measureMap.siteMarginTop||0,p=o.domMeasurements.getElementRect(a),c=p.top+s;t.get(i,"measureMap.custom.SITE_HEADER.isFixedPosition")&&(c-=i.measureMap.height.SITE_HEADER);var u=o.scrollAnchors.normalizeYOffset(c,i);return{x:p.left,y:u}},R=function(e,n){var i=e.getBoundingClientRect(),a=t(i).pick(["left","right","top","bottom","height","width"]).mapValues((function(e){return Math.floor(e)})).value();return n&&(a.top-=n),a},M=function(e,t){return{x:e.left,y:e.top-t}},O=function(e){return t.isString(e)&&/^[0-9]+%$/.test(e)},U=function(e,t){var n=t.data.eventKey;if("QUICK_ACTION_TRIGGERED"!==n){var i=e.getComponentById(t.compId);i&&i.isCompListensTo&&!i.isCompListensTo(n)&&i.startListen(n)}else!B(e,n,t.compId)&&e.getSiteData().isViewerMode()&&N(e,t.compId)},B=function(e,n,i){var a=L(e,i),o=e.getRuntimeDal().getActionsAndBehaviors("QUICK_ACTION_BAR"),r=t(o).filter({action:{sourceId:"QUICK_ACTION_BAR",name:a}}).filter({behavior:{targetId:i}}).filter({behavior:{name:"notifyWidget"}}).value();return!t.isEmpty(r)},N=function(e,t){var n=function(e,t){return{action:{type:"comp",name:t,sourceId:"QUICK_ACTION_BAR"},behavior:{type:"comp",targetId:e,name:"notifyWidget",params:{sourceId:"QUICK_ACTION_BAR",action:t}}}}(t,L(e,t));e.getRuntimeDal().addActionsAndBehaviors("QUICK_ACTION_BAR",n)};var x=function(e,t){var n=t.data.eventKey||t.data;if("QUICK_ACTION_TRIGGERED"!==n){var i=e.getComponentById(t.compId);i.stopListen&&i.stopListen(n)}else k(e,t.compId)},k=function(e,t){var n=L(e,t);e.getRuntimeDal().removeActionsAndBehaviors("QUICK_ACTION_BAR",{action:{name:n}})};function L(e,n){var i=e.getComponentById(n),a=t.get(i,"props.compData.applicationId");return e.getSiteData().getClientSpecMap()[a].appDefinitionId}var W=function(e,n,i,a){if(p.common.utils.isTPASection(n)){n.setState({pushState:a});var o=n.getAppData(),r=t.get(n,"props.compData.widgetId"),s=e.getSiteData().getPrimaryPageId();c.navigateWithoutClosingPopupIfPossible(e,{pageId:i,tpaInnerRoute:a,transition:"none"},s,void 0,void 0,void 0,t.partial(ne,e,o,r,n.props.id))}},F=function(e,t,n,i){n.getMemberDetails((function(t){null!==t?(i(t),e&&e.setSiteMemberDataState(null)):e?e.setSiteMemberDataState({callback:i}):i(null)}))},G=function(e,t,n){var i=e.getComponentById(t.compId),a=P(e);a.isLoggedIn()?F(i,0,a,(function(e){n(e)})):n(null)},V=function(e,n){var i=t.get(n,"data.pixelId"),a=t.get(n,"data.pixelType");i&&"FACEBOOK"===a&&e.initFacebookRemarketing(i)},H=function(e,n){var i=t.get(n,"data",{}),a=t.get(n,"data.eventName");a&&(delete i.eventName,e.fireFacebookRemarketingPixel(a,i))},K=function(e){var t=e.getSiteData();return{hubSecurityToken:t.getHubSecurityToken(),svSession:t.getSvSession(),metaSiteId:t.getMetaSiteId(),currentUrl:t.getCurrentUrl()}},j=function(e,n){var i=p.common.utils.getAppData(e,n.compId),a=n.data;return{type:t.get(a,"activity.type")||"TPA",appDefinitionId:i.appDefinitionId||"TPA",info:t.get(a,"activity.info")||{},details:t.get(a,"activity.details")||{},contactUpdate:t.get(a,"activity.contactUpdate")||{},instance:i.instance}},q=function(e,i,a){var o=p.common.utils.getAppDefId(e,i.compId);n.loggingUtils.performance.start("appIsAlive ".concat(o),I);var r=e.getComponentById(i.compId);if(r&&r.setAppIsAlive&&r.setAppIsAlive(),t.get(r,"hasOrigComponent"))try{a(Q(e,r)),n.loggingUtils.performance.finish("appIsAlive ".concat(o),I),n.loggingUtils.performance.finish("getStyleParams ".concat(o),I)}catch(t){e.reportBI(p.bi.events.APP_IS_ALIVE_ERROR,{app_id:o,errorMessage:t.toString()})}},Q=function(e,n){var i=e.getSiteData(),a=n&&n.hasOrigComponent()?e.getComponentById(n.getOrigComponentId()):n,r=t.get(a,"props.structure.styleId"),s=o.styleUtils.getAllThemeForSDK(i,n.getPageId(),r),p=i.rendererModel.siteInfo.documentType,c=i.getDataByQuery("masterPage").characterSets,u=i.isVisualFocusEnabled(),g=o.styleUtils.getStyleDataToPassIntoApp(r,s,i.santaBase,p,c,i.serviceTopology,!0);return t.assign(g,{isVisualFocusEnabled:u})},z=function(e,t,n){var i=e.getComponentById(t.compId).props.compData,a=e.getRootOfComponentId(t.compId);n(v.tpaDataService.getValue(e.getSiteData(),t,a,i))},X=function(e,t,n){var i=e.getSiteData(),a=e.getRootOfComponentId(t.compId),o=e.getComponentById(t.compId,a).props.compData,r={};r.APP=v.tpaDataService.getTpaDataContent(i,"tpaData-".concat(o.applicationId),"masterPage"),r.COMPONENT=v.tpaDataService.getTpaDataContent(i,o.tpaData,a),n(r)},J=function(e,n,i){var a,o=t.uniq(n.data.keys),r=e.getSiteData(),s=e.getRootOfComponentId(n.compId),p=e.getComponentById(n.compId,s).props.compData,c=n.data.scope;if(c===v.tpaDataService.SCOPE.APP){var u=v.tpaDataService.getTpaDataContent(r,"tpaData-".concat(p.applicationId),"masterPage");a=t.pick(u,o)}else{var g=v.tpaDataService.getTpaDataContent(r,p.tpaData,s);a=t.pick(g,o)}if(!t.isEmpty(a)&&t(a).keys().isEqual(o))i(a);else{var d=t.keys(a),l=t(d).xor(o).intersection(o).value();i({error:{message:"keys ".concat(l," not found in ").concat(c," scope")}})}},Y=function(e,n){return{width:t.get(e,"measureMap.width.WIX_ADS".concat(n)),height:t.get(e,"measureMap.height.WIX_ADS".concat(n)),top:t.get(e,"measureMap.top.WIX_ADS".concat(n)),left:t.get(e,"measureMap.left.WIX_ADS".concat(n))}};function Z(e,n,i){var a=null,o=e.getComponentById(n,i);if(o){var r=t.get(o.props,"compData.applicationId")||null;a=e.getSiteData().getClientSpecMapEntry(r)||null}return a||{}}var $=function(e,t){var n=e.getComponentById(t).props.compData;return n&&n.id},ee=function(e,n,i){var a,o=e.getSiteData(),r=t.get(n,["data","appDefinitionId"]);r?a=p.services.clientSpecMapService.getAppDataByAppDefinitionId(o,r):a=e.getComponentById(n.compId).getAppData();var s=t.get(a,"applicationId"),c=p.services.pageService.mapPageToWidgets(e),u=t.get(c,s);i(t.some(u,{tpaPageId:t.get(n,["data","sectionId"])}))},te=function(e,n,i){var a=e.getSiteData(),o=t.get(n,["data","appDefinitionId"]),r=p.services.clientSpecMapService.getAppDataByAppDefinitionId(a,o);if(r){var s=r.instance.split(".");i(JSON.parse(atob(s[1])).vendorProductId)}else i(null)},ne=function(e,n,i,a){var o=e.getSiteData().biData,r=o.getTime(),s={compId:a,pageId:o.getPageId(),pageNo:o.getPageNumber(),loadingTime:r.loadingTime,totalLoadingTime:r.totalLoadingTime};t.get(n,"isWixTPA")?(s.widgetId=i,s.appDefinitionId=t.get(n,"appDefinitionId")):(s.externalWidgetId=i,s.externalAppDefinitionId=t.get(n,"appDefinitionId")),m.reportBI(e.getSiteData(),p.bi.events.APP_STATE_CHANGED,s)};return t.merge({waitForWixCodeWorkerToBeReady:function(e,t,n){var i=e.getSiteAspect("WidgetAspect"),a=e.getSiteData(),o=a.getCurrentUrlPageId(),r=f.isOpen("sv_handleFailingWixCodeSdk",a)?i.isContextReadyOrLifeCycleFailed(o):i.isContextReady(o),s=e.getSiteAspect("wixCodeWidgetAspect");s&&s.isAppInitiated()?r?n({}):i.registerToOnWidgetReady(o,(function(){n({})})):n({error:!0})},siteInfo:h,heightChanged:function(e,n){var i="number"==typeof n.data?n.data:n.data.height;if(i>1e6){var a={height:i};m.reportBI(e.getSiteData(),p.bi.errors.SDK_SET_HEIGHT_ERROR,a)}var o={height:i,ignoreAnchors:n.data.overflow},r=e.getComponentById(n.compId);t.invoke(r,"registerReLayout"),t.invoke(r,"setState",o)},registerEventListener:U,removeEventListener:x,navigateTo:function(e,i,a){var o=t.get(i,"data.link");n.linkUtils.navigateToLink(e,o,a)},navigateToPage:function(e,n,i){var a=e.getSiteData().getPrimaryPageId(),r=e.getSiteData().getAllPageIds();c.navigateToPage(e,n,a,r,(function(t){var n=p.common.utils.Constants.TOP_PAGE_ANCHOR_PREFIX+t;return o.scrollAnchors.getPageAnchors(e.getSiteData(),t,n)}),t.partial($,e),i)},smRequestLogin:function(e,n,i){var a=e.getComponentById(n.compId),o=P(e);if(o.isLoggedIn())F(a,0,o,(function(e){i({authResponse:!0,data:e})}));else{var r,s=t.get(n,"data.mode"),c=s&&"login"===s,u=t.get(n,"data.language","en");t.get(n,"data.callOnCancel")&&(r=function(){i({wasCancelled:!0})});o.showAuthenticationDialog({successCallback:function(e){i({authResponse:!0,data:e})},cancelCallback:r,language:u,showLoginDialog:c,appId:p.common.utils.getAppDefId(e,n.compId),checkCommunityCheckbox:t.get(n,"data.checkCommunityCheckbox")})}},smCurrentMember:G,refreshCurrentMember:function(e){var t=P(e);t.isLoggedIn()&&t.getMemberDetails(null,null,!0)},authorizeMemberPages:function(e,t,n){var i=P(e),a=n;i.isLoggedIn()&&i.authorizeMemberPages(a,(function(){return n({error:{message:"Failed to get authorized pages"}})}))},scrollBy:function(e,t,n){e.scrollSiteBy(t.data.x,t.data.y,n)},scrollTo:function(e,n,i){n.data.scrollAnimation?e.getSiteData().animations.animate("BaseScroll",e.getSiteContainer?e.getSiteContainer():e._site.props.getSiteContainer(),1,0,{y:n.data.y,x:n.data.x,callbacks:{onComplete:function(){i&&i()}}}):e.getSiteAspect("windowScrollEvent").scrollSiteTo(n.data.x,n.data.y,t.isFunction(i)&&i)},navigateToComponent:function(e,i,a){var o=i.data.pageId,r=i.data.compId,s=e.getSiteData().getFocusedRootId(),p=e.getComponentById(r);if(p&&"wysiwyg.viewer.components.tpapps.TPAGluedWidget"===p.props.structure.componentType)a({error:{message:"Navigation to glued widget not supported."}});else if(t.isEmpty(o)||o===s)b(e,p,r,o,a);else{var c=e.getSiteData().getAllPageIds();n.linkUtils.navigateToPage(e,o,c,i.data.noPageTransition,void 0,b.bind(null,e,p,r,o,a),a)}},registerCampaignPixel:V,reportCampaignEvent:H,postActivity:function(e,t){var n=e.getComponentById(t.compId),i=K(e),a=j(e,t),o=function(e){n.sendPostMessage({intent:"TPA_RESPONSE",callId:t.callId,type:t.type,res:{response:{activityId:e.response.activityId,contactId:e.response.contactId},status:e.status},status:e.status,compId:t.compId})},r=new S(i,a);A.reportActivity(e.getSiteData().getExternalBaseUrl(),r,(function(t){t.userSessionToken&&e.setUserSession(t.userSessionToken),o({status:!0,response:t})}),(function(e){var t={status:e.status,statusText:e.statusText,responseText:e.responseText};o({status:!1,response:t})}))},getCurrentPageId:function(e,t,n){n(e.getSiteData().getCurrentUrlPageId())},getCurrentPageNavigationInfo:function(e,t,n){var i=e.getSiteData().getRootNavigationInfo(),a={};i.routerDefinition?(a.innerRoute=i.innerRoute,a.type="DynamicPageLink",a.routerId=i.routerDefinition.routerId):(a.type="PageLink",a.pageId=i.pageId),n(a)},getUserSession:function(e,t,n){n(e.getUserSession())},boundingRectAndOffsets:function(n,i,a){var o=n.getSiteData(),s=n.getComponentById(i.compId),p=r.findDOMNode(s),c=0;t.get(o,"measureMap.custom.SITE_HEADER.isFixedPosition")&&(c=o.measureMap.height.SITE_HEADER);var u=n.getRenderFlag("siteScale")||1;a({rect:R(p,c),offsets:M(e(p).offset(),c),scale:u})},navigateToSectionPage:T,getSitePages:C,getSiteMap:D,appIsAlive:q,openModal:function(e,t,n){var i=t.data||{};l.openModal(e,t.compId,i.url,i.width,i.height,i.theme,n,i.title)},openPopup:function(e,t,n){var i=t.data||{};l.openPopup(e,t.compId,i.url,i.width,i.height,i.theme,i.position,!1,n)},openPersistentPopup:function(e,t,n){var i=t.data,a=i.url,o=i.width,r=i.height,s=i.theme,p=i.position;l.openPopup(e,t.compId,a,o,r,s,p,!0,n)},closeWindow:function(e,t){var n=e.getComponentById(t.compId);n&&n.hide&&n.hide(t.data)},setFullScreenMobile:function(e,n,i){if(e.getSiteData().isMobileView()){var a=n.data.isFullScreen,o=n.compId,r=e.getComponentById(o);!function(e,n){var i=Z(e,n);return t.includes(p.common.metaData.PERMITTED_FULL_SCREEN_TPAS_IN_MOBILE,i.appDefinitionId)}(e,o)?i&&i():a?(e.enterFullScreenMode(),e.setSiteRootHiddenState(!0),r.enterFullScreen(i)):(e.setSiteRootHiddenState(!1),e.exitFullScreenMode(),r.exitFullScreen(i))}else i({error:{message:"show full screen is only available in Mobile view"}})},resizeWindow:function(e,n,i){var a=n.data.width,o=n.data.height;O(a)||(a=parseFloat(a)),O(o)||(o=parseFloat(o));var r=e.getComponentById(n.compId);(function(e){return e&&e.resizeWindow&&t.includes(["wysiwyg.viewer.components.tpapps.TPAGluedWidget","wysiwyg.viewer.components.tpapps.TPAPopup","wysiwyg.viewer.components.tpapps.TPAModal"],e.props.structure.componentType)})(r)&&r.resizeWindow(a,o,i)},appStateChanged:function(e,t){var n,i="string"==typeof t.data?t.data:t.data.state,a=e.getComponentById(t.compId),r=e.getRootOfComponentId(t.compId),s=e.getSiteData().getExistingRootNavigationInfo(r),p=s?s.pageId:r;try{switch((n=JSON.parse(i)).cmd){case"zoom":a.processImageZoom(n);break;case"itemClicked":a.processItemClicked(n);break;case"itemChanged":a.processItemChanged(n);break;case"componentReady":a.setComponentInIframeReady();break;case"navigateToDynamicPage":var c=n.args[0],u=o.wixUrlParser.getUrl(e.getSiteData(),c),g=o.wixUrlParser.parseUrl(e.getSiteData(),u);n.args[1]&&(g.anchorData=n.args[1]),e.handleNavigation(g,n.args[2]);break;case"navigateToAnchor":var d=n.args[0],l=n.args[1];e.getSiteData().getPrimaryPageId()===d?l&&e.scrollToAnchor(l):e.navigateToPage({pageId:d,pageAdditionalData:null,anchorData:l});break;default:W(e,a,p,i)}}catch(t){W(e,a,p,i)}},getSectionUrl:function(e,n,i){var a=e.getComponentById(n.compId);if(a){var o=p.services.pageService.mapPageToWidgets(e),r=e.getSiteData().getClientSpecMap()[a.props.compData.applicationId],s=r.applicationId;if(t.isEmpty(o)||t.isUndefined(o[s]))i({error:{message:'Page with app "'.concat(r.appDefinitionName,'" was not found.')}});else{var c,u=o[s],g=n.data.sectionIdentifier,d=t.find(u,{tpaPageId:g})||u[0];if(d&&(c=d.pageId),t.isUndefined(c))i({error:{message:"Page was not found."}});else{var l=e.getPageUrlFor(c);t.isUndefined(l)?i({error:{message:"Page was not found."}}):i({url:l})}}}else i({error:{message:"Component was not found."}})},postCountersReport:function(e,n,i){n.data.messageId=Date.now();var a={ctToken:e.getSiteData().getCTToken()},r=t.omit(n.data,"version"),s="?".concat(o.urlUtils.toQueryString(a)),p="//player-counters.wix.com/collector/rest/collect-js".concat(s);o.ajaxLibrary.ajax({type:"OPTIONS",url:p,data:JSON.stringify(r),dataType:"json",contentType:"application/json",success:function(e){i({status:"success",response:e})},error:function(e){var t=e&&e.responseText;i({status:"error",response:t})}})},getExternalId:function(e,t,n){var i=e.getComponentById(t.compId);i&&n(i.props.compData.referenceId)},getViewMode:function(e,t,n){n({editMode:e.getSiteData().isViewerMode()?"site":e.getRenderFlag("componentViewMode")})},getValue:z,getValues:J,getPublicData:X,getCurrentPageAnchors:function(e,t,n){var i=e.getSiteData().getCurrentUrlPageId(),a=p.common.utils.Constants.TOP_PAGE_ANCHOR_PREFIX+i,r=o.scrollAnchors.getPageAnchors(e.getSiteData(),i,a);u.getCurrentPageAnchors(e,t,i,r,n)},navigateToAnchor:function(e,n,i){var a=e.getSiteData().getCurrentUrlPageId(),r=p.common.utils.Constants.TOP_PAGE_ANCHOR_PREFIX+a,s=o.scrollAnchors.getPageAnchors(e.getSiteData(),a,r);u.navigateToAnchor(e,n,a,s,t.partial($,e),i)},getStateUrl:function(e,n,i){var a=e.getComponentById(n.compId);if(!a)return i({error:{message:"Component was not found."}});var r=p.services.pageService.mapPageToWidgets(e),s=e.getSiteData().getClientSpecMap()[a.props.compData.applicationId],c=s.applicationId;if(t.isEmpty(r)||t.isUndefined(r[c]))return i({error:{message:'Page with app "'.concat(s.appDefinitionName,'" was not found.')}});var u,g=r[c],d=t.find(g,{tpaPageId:n.data.sectionId});return u=d?{pageId:d.pageId,tpaInnerRoute:n.data.state}:{pageId:g[0].pageId},e.getSiteData().isDynamicPage(u.pageId)?i({error:{message:"Can't retrieve url for a dynamic page. Please use the platform app API instead."}}):i({url:o.wixUrlParser.getUrl(e.getSiteData(),u,void 0,!0)})},getComponentInfo:function(e,n,i){var a=e.getComponentById(n.compId),o=a.props.compData,r=a.getAppData(),s=E(a),p=r.widgets[o.widgetId];i({compId:n.compId,showOnAllPages:s,pageId:s?"":a.props.pageId,tpaWidgetId:t.get(p,"tpaWidgetId",""),appPageId:t.get(p,"appPage.id","")})},getStyleId:function(e,t,n){n(e.getComponentById(t.compId).props.structure.styleId)},getStyleParamsByStyleId:function(e,n,a){var r=e.getSiteData(),s=n.data.styleId,p=n.data.pageId,c=r.getAllStylesFromPossiblyRenderedRoots(),u=function(){if(t.isUndefined(c[s]))a({error:{message:'Style id "'.concat(s,'" was not found.')}});else{var e=r.rendererModel.siteInfo.documentType,n=r.getDataByQuery("masterPage").characterSets,i=o.styleUtils.getStylesForSDK(c,s,!0,r.serviceTopology,e,n,!0);a(i)}},g=function(){var e;(e=r.getDataByQuery(s,p,"theme_data"))&&(c[s]=e),u()};if(t.isUndefined(c[s])&&p)if(r.pagesDataRaw.pagesData[p])g();else{var d=i.dataRequirementsChecker.getRequestsForPages(r,r.pagesDataRaw,{pageId:p});r.store.loadBatch(d,g)}else u()},replaceSectionState:function(e,n){var i=e.getComponentById(n.compId),a=n.data,o=a.state,r=a.queryParams,s=a.ignorePageUriSeo,u=e.getRootOfComponentId(n.compId);if(p.common.utils.isTPASection(i)){i.setState({pushState:o});var g=i.getAppData(),d=e.getSiteData().getPrimaryPageId(),l=t.get(i,"props.compData.widgetId"),f=t.partial(ne,e,g,l,n.compId),m={pageId:u,tpaInnerRoute:o,transition:"none"};c.addAppSectionParamsToNavInfo(r,m),c.navigateWithoutClosingPopupIfPossible(e,m,d,!1,!0,void 0,f,s)}},logOutCurrentMember:function(e,n,i){var a=P(e);if(a.isLoggedIn()){var o=t.get(n,"data.language");a.logout(o)}else i({onError:"No member is logged in"})},getCtToken:function(e,n,i){t.isFunction(i)&&i(e.getSiteData().getCTToken())},setPageMetadata:function(e,n,i){var a=e.getComponentById(n.compId);if(a){var o=p.common.utils.isTPASection(a),r=t.get(a,"props.pageId")===e.getSiteData().getCurrentUrlPageId();if(o)if(r){var s,c=e.getPageData(),u=t.get(c,"title",""),g=t.get(n,"data.title"),d=t.get(n,"data.fullTitle"),l=t.get(n,"data.description")||t.get(c,"descriptionSEO",""),f=t.get(e.getSiteData(),"rendererModel.siteInfo.siteTitleSEO");if(d){var m=a.getAppData();if(t.get(m,"isWixTPA"))return void e.setRunTimePageTitle(u,l,d)}g&&(s="".concat(g," | ").concat(f)),e.setRunTimePageTitle(u,l,s)}else y(i,"Setting a page meta data is possible only to component that is located on the current page");else y(i,"Setting a page meta data is possible only to TPA Sections and MultiSections")}},buildCustomizedUrl:function(e,t,n){n(void 0)},getCustomizedUrlSegments:function(e,t,n){n(void 0)},setAppMetadata:function(e,n,i){var a=e.getComponentById(n.compId);if(a){var o=a.getAppData(),r=t.get(o,"isWixTPA"),c=p.common.utils.isTPASection(a),u=t.get(a,"props.pageId")===e.getSiteData().getCurrentUrlPageId();if(!r)return;if(!c)return void y(i,"Setting an app meta data is possible only for TPA Sections and MultiSections");if(!u)return void y(i,"Setting an app meta data is possible only for components that are located on the current page");var g=t.reduce(s.constants.TPA_LINK_TAGS.SUPPORTED_RELS,(function(e,i){var a=t.get(n,"data.".concat(i,".href"));return a&&(e[i]=a),e}),{});return e.setRunTimeLinkTags(g)}},removeAppMetadata:function(e,n,i){var a=e.getComponentById(n.compId);if(a){var o=a.getAppData(),r=t.get(o,"isWixTPA"),c=p.common.utils.isTPASection(a),u=t.get(a,"props.pageId")===e.getSiteData().getCurrentUrlPageId();if(!r)return;if(!c)return void y(i,"Removing an app meta data is possible only for TPA Sections and MultiSections");if(!u)return void y(i,"Removing an app meta data is possible only for components that are located on the current page");var g=t.reduce(t.get(n,"data"),(function(e,n,i){return n&&t.includes(s.constants.TPA_LINK_TAGS.SUPPORTED_RELS,i)&&e.push(i),e}),[]);return e.removePageSEORuntimeData(g)}},applicationLoaded:g.applicationLoaded,applicationLoadingStep:g.applicationLoadingStep,getAdsOnPage:function(e,t,n){var i=e.getSiteData();i.shouldShowWixAds()?n({top:Y(i,"top")}):n({})},setMobileActionBarButton:function(e,n,i){var a=Z(e,(n=n||{}).compId).appDefinitionId;a||i({error:{message:"No matching app definition found for comp id ".concat(n.compId)}});var o=function(e){var n={};t.isBoolean(e.visible)&&(n.enabled=e.visible);t.isBoolean(e.notifications)&&(n.notificationCount=e.notifications?1:0);t.isString(e.color)&&(n.color=e.color);return n}(n.data||{});!t.isEmpty(o)&&(o.appId=a,function(e){return e.getSiteAspect("QuickActionBarAspect")}(e).updateDynamicActions(o)),i&&i()},isAppSectionInstalled:ee,getAppVendorProductId:te,hasLoginOnPage:function(e,n,i){var a="wysiwyg.viewer.components.LoginSocialBar",o=e.getSiteData().getFocusedRootId(),r=e.getComponentsByPageId(o),s=t.some(r,["props.structure.componentType",a]);s||e.isPageLandingPage(o)||e.getSiteData().isPopupPage(o)||(r=e.getComponentsByPageId("masterPage"),s=t.some(r,["props.structure.componentType",a])),i(s)},registerApi:function(e,n){var i=e.getComponentById(n.compId),a=t.get(i.getIframe(),"id");e.getSiteAspect("TPARPCAspect").registerApi(a,n.compId)},requireSingletonAPI:function(e,n,i){var a=t.get(n.data,"appDefId"),o=t.get(n.data,"componentType");e.getSiteAspect("TPARPCAspect").requireSingletonAPI(a,o,i)},trackEvent:function(e,n){var i=t.get(n,"data.eventName"),a=t.get(n,"data.params"),r=t.get(n,"data.options");o.integrations.promoteAnalytics.trackEvent(e,i,a,r)},revalidateSession:function(e,n,i){var a=e.getComponentById(n.compId).getAppData(),o=t.get(a,"applicationId");e.getSiteAspect("dynamicClientSpecMap").getNewAppInstance(o,(function(e){i(e?{instance:e}:{error:{message:"Error getting new instance from server"}})}))},onReady:function(e,t,n){e.registerToOnFullyRendered(n)},echo:function(e,t,n){n()},getApplicationFields:function(e,n,i){var a=t.get(n.data,"appDefinitionId"),o=t(e.getSiteData().getClientSpecMap()).values().find({appDefinitionId:a});i(t.get(o,"appFields",{}))},tpaWorker:{siteInfo:h,getSitePages:C,getSiteMap:D,removeEventListener:x,registerEventListener:U,registerCampaignPixel:V,reportCampaignEvent:H,smCurrentMember:G,appIsAlive:q,navigateToSectionPage:T,getValue:z,getValues:J,getPublicData:X,applicationLoaded:g.applicationLoaded,applicationLoadingStep:g.applicationLoadingStep,isAppSectionInstalled:ee,getAppVendorProductId:te}},d)}.apply(t,i))||(e.exports=a)},291:function(e,t,n){var i,a;i=[n(0),n(2),n(29),n(292)],void 0===(a=function(e,t,n,i){"use strict";var a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!e.isEmpty(t))try{n.queryParams={appSectionParams:JSON.stringify(t)},n.hasAppSectionParams=!0}catch(e){}},o=function(e,t,n,i,a){n&&(t?(e.updateSectionUrlState(n,i),e.updateSectionUrlParams(n,a)):(e.updatePushState(n,i),e.reportStateChanged(n,i)))},r=function(e,t,i){var a={appDefinitionName:t||"",sectionId:i||""};e.reportBI(n.bi.errors.SDK_NAVIGATION_TO_SECTION_ERROR,a)},s=function(t,n,i,a,o,r,s,p){n.pageId===i?(t.updatePageNavInfo(n,a,o,p),r&&t.scrollSiteTo(0,0)):t.navigateToPage(n,a,o,p),e.isFunction(s)&&s()};return{addAppSectionParamsToNavInfo:a,navigateToSection:function(t,i,p,c,u,g,d,l,f){if(i){var m,v,I,S,A=!1,P=p.data||"",h=!0,y={},C=!1;if(e.isObject(p.data)&&(h=e.get(p,"data.sectionIdentifier.shouldRefreshIframe",!0),P=e.get(p,"data.sectionIdentifier.state")||p.data.state||"",y=e.get(p,"data.sectionIdentifier.queryParams"),v=e.get(p,"data.sectionIdentifier.sectionId"),A=e.get(p,"data.sectionIdentifier.noTransition"),S=e.get(p.data,["sectionIdentifier","customizeTarget","pageBackground"]),C=e.get(p.data,"ignorePageUriSeo",!1)),e.isUndefined(c)||e.isEmpty(c))r(t,i.appDefinitionName,v),l({error:{message:'Page with app "'.concat(i.appDefinitionName,'" was not found.')}});else{if(e.isUndefined(v))m=c[0].pageId,I=e.find(e.get(i,"widgets"),(function(t){return e.get(t,"appPage.name")&&!e.get(t,"appPage.hidden")}));else{var D=e.find(c,{tpaPageId:v});if(e.isUndefined(D))return r(t,i.appDefinitionName,v),void l({error:{message:'App page with sectionId "'.concat(v,'" was not found.')}});m=D.pageId,I=n.services.clientSpecMapService.getWidgetDataByTpaPageId(i,v)}if(d(m))return r(t,i.appDefinitionName,v),void l({error:{message:"Can't navigate to a dynamic page. Please use the platform app API instead."}});var T=g(m);o(t,h,T,P,y);var b,E={pageId:m,tpaInnerRoute:P};a(y,E),A&&(E.transition="none"),S&&(!function(t){if(!e.startsWith(t,"rgba"))return!1;var n=(t=e(t).replace("rgba","").replace("(","").replace(")","")).split(",");if(4!==n.length)return!1;if(!e.every(n.slice(0,3),(function(e){var t=e>=0&&e<=255,n=parseFloat(e),i=!isNaN(n)&&n>0&&n<=100;return t||i})))return!1;var i=e.last(n);return!i||i>=0&&i<=1}(S)?l({error:{message:'Color should be rgba but "'.concat(S,'" is not rgba format.')}}):E.pageBackgroundColorOverride=S),e.isFunction(f)&&(b=e.partial(f,e.get(I,"widgetId"),T)),s(t,E,u,void 0,void 0,!0,b,C)}}else{var _=e.get(p,"data.sectionIdentifier.appDefinitionId");_?(r(t),l({error:{message:'Application with appDefinitionId "'.concat(_,'" was not found on the site.')}})):(r(t),l({error:{message:"Component was not found."}}))}},navigateWithoutClosingPopupIfPossible:s,navigateToPage:function(n,a,o,r,s,p,c){var u=e.get(a,"data.pageId"),g=e.get(a,"data.noTransition"),d=e.get(a,"data.anchorId"),l=s(u);o===u?d&&i.navigateToAnchor(n,a,u,l,p,c):t.linkUtils.navigateToPage(n,u,r,g,void 0,(function(){d&&i.navigateToAnchor(n,a,u,l,p,c)}),c)}}}.apply(t,i))||(e.exports=a)},292:function(e,t,n){var i,a;i=[n(0),n(2)],void 0===(a=function(e,t){"use strict";var n=function(e){return{id:e.compId,title:e.name}},i=function(t,i){return e.map(i,n)};function a(t,n,a){var o=i(t,n);return e.some(o,{id:a})}return{getCurrentPageAnchors:function(e,t,n,a,o){o(i(n,a))},navigateToAnchor:function(e,n,i,o,r,s){var p=n.data.anchorId;if(p===t.siteConstants.PAGE_ANCHORS.TOP_ANCHOR_COMP_ID)e.scrollToAnchor(t.siteConstants.PAGE_ANCHORS.TOP_ANCHOR_ID);else if(p===t.siteConstants.PAGE_ANCHORS.BOTTOM_ANCHOR_COMP_ID)e.scrollToAnchor(t.siteConstants.PAGE_ANCHORS.BOTTOM_ANCHOR_ID);else if(a(i,o,p)){var c=r(p);c&&e.scrollToAnchor(c)}else s&&s({error:{message:'anchor with id "'.concat(p,'" was not found on the current page.')}})},isAnchorExistsOnPage:a}}.apply(t,i))||(e.exports=a)},293:function(e,t,n){var i,a;i=[n(6),n(0),n(7)],void 0===(a=function(e,t,n){"use strict";var i=function(e){if(t.isString(e)){var n=parseInt(e,10);return t.isNaN(n)?0:n}return t.isNumber(e)?e:0},a=function(e){return t.get(e,"props.compData.tpaData")},o=function(e,i,o,r,s,p,c){var u=e.getComponentById(i);return{origCompId:i,applicationId:t.get(u,"props.compData.applicationId"),externalId:t.get(u,"props.compData.referenceId"),tpaData:a(u),url:o,width:r,height:s,theme:p,title:c,windowSize:{width:n(window).width(),height:n(window).height()}}};return{openModal:function(e,n,i,a,r,s,p,c){var u=function(e){return e.getSiteAspect("tpaModalAspect")}(e),g=function(e,n,i,a,r,s,p){var c=o(e,n,i,a,r,s,p);return t.omitBy(c,t.isUndefined)}(e,n,i,a,r,s,c);u.showModal(g,p)},openPopup:function(a,r,s,p,c,u,g,d,l){if(!function(e){return!t.includes(["wysiwyg.viewer.components.tpapps.TPAModal"],t.get(e,"props.structure.componentType"))}(a.getComponentById(r))){var f=new Error;throw f.name="Operation not supported",f.message="An app can not open a popup from a modal.",f}(function(e){return e.getSiteAspect("tpaPopupAspect")})(a).showPopup(function(a,r,s,p,c,u,g,d){var l=a.getComponentById(r),f=o(a,r,s,p,c,u),m=e.findDOMNode(l);if(m){f.origCompStyle=n(m).offset();var v=m.getBoundingClientRect();f.origCompStyle.actualTop=v.top,f.origCompStyle.actualLeft=v.left}return f.position=t.defaults(g||{},{origin:"FIXED",placement:"CENTER",x:0,y:0}),f.position.x=i(f.position.x),f.position.y=i(f.position.y),f.persistent=d,t.omitBy(f,t.isUndefined)}(a,r,s,p,c,u,g,d),l)}}}.apply(t,i))||(e.exports=a)},294:function(e,t,n){var i,a;i=[n(0),n(29),n(16)],void 0===(a=function(e,t,n){"use strict";var i={};return{sendBIEvent:function(a,o,r,s,p){var c=function(t,n){return t.widgetId=e.get(n,"widgetId"),t.appId=e.get(n,"applicationId"),t}(a,r);if(function(e,t){return t&&e.version&&e.type&&e.namespace}(c,r)){var u=e.get(r,"applicationId"),g={count:1,target:1};if(e.has(i,[u,a.type])?++(g=e.get(i,[u,a.type])).count:(i[u]||(i[u]={}),i[u][a.type]=g),g.count===g.target){var d={visitorUuid:t.common.utils.getVisitorUuid(n),sdkVersion:c.version,origin:o,fnName:c.type,param:JSON.stringify(a.data),namespace:c.namespace,count:g.count};if(c.appId){var l=function(e,n){var i,a,o,r=t.common.utils.getInstanceFromClientSpecMap(n,e.appId);if(!n[e.appId])throw new Error("app definition could not be found by the given appId");return{appId:n[e.appId].appDefinitionId,instanceId:r.instanceId,isPublished:(i=n[e.appId],a=e.widgetId,o=i.widgets[a],(o?o.published||o.santaEditorPublished:i.sectionPublished)?1:0)}}(c,s);e.merge(d,l)}p(c.appId?t.bi.events.JS_SDK_FUNCTION_CALL:t.bi.events.GALLERY_FUNCTION_CALL,d),g.target*=10}}}}}.apply(t,i))||(e.exports=a)},3:function(e,t){e.exports=n},46:function(e,t){e.exports=u},6:function(e,t){e.exports=i},7:function(e,t){e.exports=a},8:function(e,t){e.exports=o},9:function(e,t){e.exports=r}})}));
//# sourceMappingURL=tpa.min.js.map